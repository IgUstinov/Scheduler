# Scheduler

**Scheduler** — приложение для симуляции планировщика задач операционной системы реального времени (RTOS). Оно моделирует управление задачами, используя приоритетное планирование, прерывания и очереди FIFO. Также приложение поддерживает раздельный запуск и взаимодействие генератора и планировщика через WebSocket, ведение подробных логов и генерацию документации через JSDoc.

---

## **Содержание**

-   [Возможности](#возможности)
-   [Установка](#установка)
-   [Использование](#использование)
-   [Работа приложения](#работа-приложения)
-   [Описание файлов](#описание-файлов)
-   [Тестирование](#тестирование)
-   [Документация](#документация)
-   [Пример вывода](#пример-вывода)
-   [Логи](#логи)
-   [Лицензия](#лицензия)

---

## **Возможности**

-   **Планировщик задач:**

    -   Поддержка 4 уровней приоритетов (0–3), где 3 — наивысший.
    -   Прерывание задач с меньшим приоритетом.
    -   FIFO-очередь для задач с одинаковым приоритетом.

-   **Два типа задач:**

    -   **Базовые задачи:** Выполняются до завершения или прерывания.
    -   **Расширенные задачи:** Могут временно переходить в состояние ожидания (`WAITING`) и освобождать процессор.

-   **WebSocket для независимого запуска компонентов.**

-   **Логирование и JSDoc-документация:**
    -   Логи записываются в директорию `logs` и отражают состояния задач, действия планировщика и генератора.
    -   JSDoc-документация доступна для основных компонентов приложения.

---

## **Установка**

1. Клонируйте репозиторий:

    ```bash
    git clone https://github.com/IgUstinov/Scheduler.git
    cd Scheduler
    ```

2. Установите зависимости:
    ```bash
    npm install
    ```

---

## **Использование**

1. **Автоматический запуск планировщика:**

    ```bash
    npm run start:auto-scheduler
    ```

2. **Ручной запуск планировщика:**

    ```bash
    npm run start:manual-scheduler
    ```

3. **Автоматическая генерация задач:**

    ```bash
    npm run start:auto-generator
    ```

4. **Ручная генерация задач:**

    ```bash
    npm run start:manual-generator
    ```

5. **Запуск тестов:**

    ```bash
    npm test
    ```

6. **Генерация документации:**

    ```bash
    npm run jsdoc
    ```

7. **Линтинг и форматирование кода:**
    ```bash
    npm run lint
    npm run format
    ```

---

## **Работа приложения**

### **Задачи и их состояния**

В системе моделируются два типа задач:

1. **Базовые задачи:**

    - Выполняются до завершения либо до прерывания более приоритетной задачей.
    - Не могут освобождать процессор.

2. **Расширенные задачи:**
    - Могут освобождать процессор, переходя в состояние ожидания (`WAITING`).
    - Возвращаются к выполнению, когда завершается событие, связанное с их ожиданием.

**Состояния задач:**

-   **`SUSPENDED`** — задача создана, но не готова к выполнению.
-   **`READY`** — задача готова к выполнению.
-   **`RUNNING`** — задача выполняется.
-   **`WAITING`** — расширенная задача приостановила выполнение и ждет события.

**Переходы между состояниями задач**

В приложении реализованы следующие состояния и переходы для управления жизненным циклом задач:

-   **`SUSPENDED → READY`** _(activate)_ — задача активирована.
-   **`READY → RUNNING`** _(start)_ — задача начала выполнение.
-   **`RUNNING → WAITING`** _(wait)_ — расширенная задача приостановила выполнение и ожидает события.
-   **`WAITING → READY`** _(release)_ — событие завершено, задача снова готова к выполнению.
-   **`RUNNING → SUSPENDED`** _(terminate)_ — задача завершила выполнение.
-   **`RUNNING → READY`** _(preempt)_ — задача прервана более приоритетной задачей и возвращена в очередь готовности.

---

### **Планировщик задач**

-   Использует 4 уровня приоритета задач (0 — низший, 3 — высший).
-   Если задачи с одинаковым приоритетом, применяется FIFO-очередь.
-   Более приоритетная задача вытесняет менее приоритетную.
-   Расширенные задачи могут освобождать процессор для других задач ожидая событие.

---

### **Генератор задач**

-   Задачи автоматически создаются с случайными характеристиками:
    -   Уровень приоритета.
    -   Тип задачи (базовая или расширенная).
    -   Время выполнения и ожидания (для расширенных задач).
-   Генератор взаимодействует с планировщиком через WebSocket.

---

## **Описание файлов**

### **1. Директория `src`**

-   **`generator/`**

    -   **`Generator.js`**: Создает задачи с случайными характеристиками.
    -   **`AutoGenerator.js`**: Автоматически отправляет задачи через WebSocket.
    -   **`ManualGenerator.js`**: Позволяет создавать задачи по одной.

-   **`scheduler/`**

    -   **`Scheduler.js`**: Управляет задачами, используя очереди и приоритеты.
    -   **`AutoScheduler.js`**: Автоматический запуск планировщика.
    -   **`ManualScheduler.js`**: Ручной запуск планировщика.

-   **`task/`**

    -   **`Task.js`**: Класс задач, описывает их состояния и методы переходов между ними.

-   **`logger/`**

    -   **`Logger.js`**: Логирование событий в систему.

-   **`websocket/`**
    -   **`WebSocketServer.js`**: Создание сервера WebSocket.
    -   **`WebSocketClient.js`**: Подключение к серверу WebSocket.

---

### **2. Директория `test`**

-   **`generator/*.test.js`**:

    -   **100%** покрытие тестами всех методов класса Generator.
    -   Проверка отправки задач через WebSocket.
    -   Тестирование генерации задач.

-   **`scheduler/*.test.js`**:

    -   **100%** покрытие тестами всех методов класса Scheduler.
    -   Тестирование прерывания и выполнения задач.
    -   Проверка правильности планирования задач по приоритетам.

-   **`task/*.test.js`**:

    -   **100%** покрытие тестами всех методов класса Task.
    -   Тестирование поведения базовых и расширенных задач.
    -   Проверка переходов между состояниями задач.

-   **`logger/*.test.js`**:

    -   **100%** покрытие тестами всех методов класса Logger.
    -   Проверка записи логов для задач, генератора и планировщика.

-   **`websocket/*.test.js`**:
    -   Проверка взаимодействия между клиентом и сервером WebSocket.

---

## **Тестирование**

Приложение покрыто тестами с использованием **Jest** и библиотеки **mock-socket**. Тесты обеспечивают проверку функциональности всех компонентов и корректность их взаимодействия.

### Для запуска тестов выполните:

```bash
npm test
```

### **Проверка покрытия:**

```bash
jest --coverage
```

### **Результаты покрытия тестами:**

```bash
 PASS  test/logger/Logger.test.js
 PASS  test/scheduler/Scheduler.test.js
 PASS  test/scheduler/ManualScheduler.test.js
 PASS  test/generator/ManualGenerator.test.js
 PASS  test/generator/AutoGenerator.test.js
 PASS  test/task/Task.test.js
 PASS  test/scheduler/AutoScheduler.test.js
 PASS  test/websocket/WebSocketClient.test.js
 PASS  test/generator/Generator.test.js
 PASS  test/websocket/WebSocketServer.test.js
---------------|---------|----------|---------|---------|-------------------
File           | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s
---------------|---------|----------|---------|---------|-------------------
All files      |     100 |      100 |     100 |     100 |
 generator     |     100 |      100 |     100 |     100 |
  Generator.js |     100 |      100 |     100 |     100 |
 logger        |     100 |      100 |     100 |     100 |
  Logger.js    |     100 |      100 |     100 |     100 |
 scheduler     |     100 |      100 |     100 |     100 |
  Scheduler.js |     100 |      100 |     100 |     100 |
 task          |     100 |      100 |     100 |     100 |
  Task.js      |     100 |      100 |     100 |     100 |
---------------|---------|----------|---------|---------|-------------------

Test Suites: 10 passed, 10 total
Tests:       58 passed, 58 total
Snapshots:   0 total
Time:        0.52 s, estimated 1 s
Ran all test suites.
```

---

## **Документация**

Для генерации документации по всем файлам выполните:

```bash
npm run jsdoc
```

Документация будет сгенерирована в директорию `out/`.

---

## **Пример вывода**

Пример работы приложения:

```plaintext
2024-11-24 21:25:53 [Schedule]    [empty]    Нет задач для выполнения
2024-11-24 21:25:54 [Generator]   [make]     Создана задача 1 приоритет 3 расширенная интервал уведомлений 585 время выполнения 769 время ожидания 774
2024-11-24 21:25:54 [Task]        [state]    Задача 1 расширенная перешла из suspended в ready.
2024-11-24 21:25:54 [Schedule]    [exec]     Задача 1 выполняется...
```

---

## **Логи**

Логи записываются в директорию `logs`:

-   **`app.log`** — все события.
-   **`generator.log`** — события генератора задач.
-   **`scheduler.log`** — события планировщика.
-   **`task.log`** — состояния задач.

---

## **Лицензия**

Проект распространяется под лицензией MIT.
